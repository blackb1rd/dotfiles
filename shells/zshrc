#!/bin/zsh

# sources external in folder .shells
for file in $HOME/.shells/zsh/*
do
  source $file
done

zstyle ':completion:*:*:git:*' script $HOME/.shells/git/git-completion.zsh

pathadd "/sbin"
pathadd "$HOME/.go/bin/"
case $(uname) in
  CYGWIN_NT-* | MSYS_NT-* )
    export EDITOR=vim
    pathadd "/mingw64/bin"
    export GOROOT=/mingw64/lib/go
    export GOPATH=/mingw64
    ;;
  * )
    if [ -d "$HOME/.pyenv" ] ; then
      export PYENV_ROOT=$HOME/.pyenv
      if [ -d "$PYENV_ROOT/bin" ] ; then
        pathadd "$PYENV_ROOT/bin"
      else
        pathadd "$PYENV_ROOT/shims"
      fi
      if command -v pyenv > /dev/null 2>&1; then
        eval "$(pyenv init - --no-rehash)"
        eval "$(pyenv virtualenv-init -)"
      fi
      pyenv activate neovim3 2> /dev/null
      if [[ -n $VIRTUAL_ENV && -e "${VIRTUAL_ENV}/bin/activate" ]]; then
        source "${VIRTUAL_ENV}/bin/activate"
      fi
    fi
    export GOPATH=$HOME/.go
    export PYTHONSTARTUP=$HOME/.pythonrc
    if [[ -x $(command -v nvim) ]] ; then
      export EDITOR=nvim
      alias vim="nvim"
      alias vimdiff='nvim -d'
    else
      export EDITOR=vim
    fi

    if [ -f "/etc/os-release" ] ; then
      os_release_id="$(grep -E '^ID=([a-zA-Z]*)' /etc/os-release | cut -d '=' -f 2)"
      os_version_id="$(grep -E '^VERSION_ID="([0-9\.]*)"' /etc/os-release | cut -d '=' -f 2 | tr -d '"')"
      case "$os_release_id" in
        "ubuntu")
          export GOROOT=/usr/lib/go-1.10/
          pathadd "/usr/lib/go-1.10/bin"
          ;;
        "debian")
          export GOROOT=/usr/local/go/
          pathadd "/usr/local/go/bin"
      esac
    fi
    ;;
esac
export TERM=xterm-256color

zsh_custom_ip(){
  local ip
  case $(uname) in
    CYGWIN_NT-* | MSYS_NT-*)
      ip=$(route print 2>&1 | grep -P "^ +0.0.0.0 +0.0.0.0 +" | awk '{print $4}')
      ;;
    *)
      if [[ -n $(ifconfig | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*') ]] ; then
        ip=$(ifconfig | \
          grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | \
          grep -Eo '([0-9]*\.){3}[0-9]*' | \
          grep -v '127.0.0.1' | \
          awk 'FNR==1{print $1}')
      else
        ip=$(route 2>&1 | awk 'FNR==3{print $1}')
      fi
      ;;
  esac
  local color="%F{black}"
  echo -n "%{$color%}$ip"
}

POWERLEVEL9K_INSTALLATION_PATH=$ANTIGEN_BUNDLES/bhilburn/powerlevel9k
POWERLEVEL9K_MODE='nerdfont-complete'
POWERLEVEL9K_DIR_HOME_SUBFOLDER_BACKGROUND='green'
POWERLEVEL9K_SHORTEN_DIR_LENGTH=2
POWERLEVEL9K_SHORTEN_STRATEGY="truncate_from_right"
POWERLEVEL9K_PROMPT_ON_NEWLINE=true
POWERLEVEL9K_RPROMPT_ON_NEWLINE=true
POWERLEVEL9K_MULTILINE_FIRST_PROMPT_PREFIX="%K{green}%k"
POWERLEVEL9K_MULTILINE_LAST_PROMPT_PREFIX="%K{028}%F{black} \uf155%f%F{028} %k\ue0b0%f "
POWERLEVEL9K_CUSTOM_IP="zsh_custom_ip"
POWERLEVEL9K_CUSTOM_IP_BACKGROUND=green
POWERLEVEL9K_TIME_FORMAT="\uf017 %D{%H:%M} \uf073 %D{%d.%m.%y}"
POWERLEVEL9K_TIME_BACKGROUND=cyan
POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(os_icon dir dir_writable vcs)
POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(time custom_ip background_jobs ram pyenv rbenv rvm)
DEFAULT_USER=`whoami`
source $HOME/.antigen.zsh

# Load the oh-my-zsh's library
antigen use oh-my-zsh

antigen bundle colored-man-pages
antigen bundle colorize
antigen bundle command-not-found
antigen bundle git
antigen bundle golang
antigen bundle pip
antigen bundle screen
antigen bundle tmux
antigen bundle wd
antigen bundle zsh-users/zsh-autosuggestions
antigen bundle zsh-users/zsh-completions
antigen bundle zsh-users/zsh-history-substring-search
antigen bundle zsh-users/zsh-syntax-highlighting

# Load the theme
antigen theme bhilburn/powerlevel9k powerlevel9k --branch=next

# Tell antigen that you're done
antigen apply

[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
